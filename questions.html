<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>–ò—Å—Ç–æ—Ä–∏—è ‚Äî –í–æ–ø—Ä–æ—Å—ã</title>

<link href="https://fonts.googleapis.com/css2?family=Spectral+SC:wght@400;600&family=Playfair+Display:wght@400;600&display=swap" rel="stylesheet">

<style>
:root{
  --cream:#FBF7F2;--ink:#4A3A39;
  --card:rgba(255,255,255,.78);--veil:rgba(255,255,255,.9);
  --gold2:#9b7f64;--gold3:#d7c29c;--gold4:#b99673;
  --shadow:0 14px 38px rgba(0,0,0,.14);--radius:26px;
}
*{margin:0;padding:0;box-sizing:border-box}
body{
  background:url("assets/background3.jpg") center/cover fixed no-repeat;
  font-family:"Playfair Display",serif;color:var(--ink);
  min-height:100vh;overflow-x:hidden;
}

#glitter{position:fixed;inset:0;pointer-events:none;z-index:1}

/* MAIN CARD */
.container{max-width:780px;margin:120px auto;padding:20px}
.card{
  background:var(--card);backdrop-filter:blur(10px);
  border-radius:var(--radius);padding:32px;
  border:1px solid rgba(255,255,255,.92);
  box-shadow:var(--shadow);animation:fade .7s ease;
}
@keyframes fade{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}

h1{font-family:"Spectral SC",serif;text-align:center;margin-bottom:8px;
background:linear-gradient(90deg,#9b7f64,#d7c29c,#b99673);
-webkit-background-clip:text;color:transparent}

.progress-wrap{margin:10px 0 18px}
.progress-top{display:flex;justify-content:space-between;font-weight:600}
.progress{width:100%;height:8px;background:rgba(255,255,255,.6);border-radius:999px;overflow:hidden;margin-top:8px}
.bar{height:100%;width:0;background:linear-gradient(90deg,var(--gold2),var(--gold4));transition:.4s}

h2.q{font-family:"Spectral SC";font-size:28px;margin:8px 0 12px}
textarea{
  width:100%;height:160px;padding:16px;border:none;border-radius:16px;
  background:var(--veil);font-size:20px;box-shadow:inset 0 2px 8px rgba(0,0,0,.06)
}

.btn{
  border:none;cursor:pointer;color:#fff;font-weight:700;
  background:linear-gradient(130deg,var(--gold2),var(--gold4));
  padding:14px 30px;border-radius:999px;font-size:20px;
  box-shadow:0 12px 32px rgba(0,0,0,.18);transition:.25s;margin-top:18px
}
.btn:hover{transform:translateY(-3px);opacity:.96}

/* PHOTO STEP */
.photo-upload-btn{
  background:linear-gradient(130deg,#b99673,#d7c29c);
  color:white;padding:12px 26px;border-radius:999px;
  display:inline-block;cursor:pointer;font-weight:600;margin-bottom:12px;
  font-family:"Spectral SC";letter-spacing:.5px;
}
.photo-upload-btn input{display:none}

.photo-preview{display:flex;flex-wrap:wrap;gap:12px;margin-top:12px;justify-content:center}

.preview-item{position:relative;opacity:1;transition:.25s}
.preview-item.removing{opacity:0;transform:scale(.8)}

.preview-img{width:82px;height:82px;border-radius:14px;object-fit:cover;cursor:pointer;
box-shadow:0 4px 14px rgba(0,0,0,.12);transition:.25s}
.preview-img:hover{transform:scale(1.08);box-shadow:0 8px 22px rgba(0,0,0,.18)}

.remove-btn{
  position:absolute;top:4px;right:4px;
  width:22px;height:22px;border-radius:50%;
  background:rgba(0,0,0,.65);color:white;
  display:flex;justify-content:center;align-items:center;
  font-size:16px;cursor:pointer;font-weight:bold;
  box-shadow:0 2px 6px rgba(0,0,0,.35)
}
.remove-btn:hover{background:rgba(0,0,0,.8)}

/* MODAL */
.modal-back{
  position:fixed;inset:0;display:none;justify-content:center;align-items:center;
  backdrop-filter:blur(14px);background:rgba(0,0,0,.25);
  z-index:90;animation:fade .35s ease;
}
.modal{
  background:var(--card);border-radius:22px;padding:30px;
  width:90%;max-width:420px;text-align:center;
  box-shadow:0 18px 45px rgba(0,0,0,.2);
  animation:pop .35s ease;
}
@keyframes pop{from{transform:scale(.92);opacity:0}to{transform:scale(1);opacity:1}}

.tariff{
  background:white;border-radius:16px;padding:18px;margin-top:14px;border:1px solid rgba(0,0,0,.06)
}
.tariff .btn{width:100%;margin-top:8px;padding:10px;font-size:18px}
</style>
</head>

<body>

<canvas id="glitter"></canvas>

<div id="payModal" class="modal-back">
  <div class="modal">
    <h2 class="Spectral">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ</h2>

    <div class="tariff">
      <p><b>‚ú® Digital ‚Äî 9‚Ç¨</b></p>
      <p>PDF-–∫–Ω–∏–≥–∞ + Telegram –¥–æ—Å—Ç–∞–≤–∫–∞</p>
      <button class="btn" onclick="alert('–û–ø–ª–∞—Ç–∞ –ø–æ–¥–∫–ª—é—á–∏–º')">–í—ã–±—Ä–∞—Ç—å</button>
    </div>

    <div class="tariff">
      <p><b>üìñ –ü–µ—á–∞—Ç—å ‚Äî 39‚Ç¨</b></p>
      <p>–ü–µ—á–∞—Ç—å –∫–Ω–∏–≥–∏ + PDF + –¥–æ—Å—Ç–∞–≤–∫–∞</p>
      <button class="btn" onclick="alert('–û–ø–ª–∞—Ç–∞ —Å–∫–æ—Ä–æ üí≥')">–í—ã–±—Ä–∞—Ç—å</button>
    </div>
  </div>
</div>

<div class="container">

<div id="questionStep" class="card">
  <h1>–ü—Ä–æ–±–Ω–∞—è —á–∞—Å—Ç—å</h1>
  <div class="progress-wrap">
    <div class="progress-top"><span id="label">–í–æ–ø—Ä–æ—Å 1 –∏–∑ 5</span><span id="perc">0%</span></div>
    <div class="progress"><div id="bar" class="bar"></div></div>
  </div>
  <h2 id="q" class="q"></h2>
  <textarea id="a" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç..."></textarea>
  <button class="btn" id="next">–î–∞–ª–µ–µ</button>
</div>

<div id="photoStep" class="card" style="display:none;">
  <h1>–î–æ–±–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ</h1>
  <p>–ß—Ç–æ–±—ã –∫–Ω–∏–≥–∞ —Å—Ç–∞–ª–∞ –µ—â—ë —Ç–µ–ø–ª–µ–µ ü§ç<br><small>(–ø–æ –∂–µ–ª–∞–Ω–∏—é ‚Äî –º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å)</small></p>

  <label class="photo-upload-btn">
    üìé –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–æ—Ç–æ
    <input type="file" id="photos" multiple accept="image/*">
  </label>

  <div id="preview" class="photo-preview"></div>

  <button class="btn" onclick="sendPhotos()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</button>
  <button class="btn" style="margin-top:10px" onclick="finish()">–°–æ–∑–¥–∞—Ç—å –º–æ—é –∫–Ω–∏–≥—É ‚ù§Ô∏è</button>
</div>

</div>

<script>
/* Glitter */
const c=document.getElementById('glitter'),x=c.getContext('2d');let W,H,p=[];
function R(){W=c.width=innerWidth;H=c.height=innerHeight}addEventListener('resize',R);R();
function S(n=60){for(let i=0;i<n;i++)p.push({x:Math.random()*W,y:Math.random()*-H*.2,r:Math.random()<.2?2.4:.8,o:1,v:1.2+Math.random()*1.2})}
function A(){x.clearRect(0,0,W,H);x.globalCompositeOperation='lighter';
p.forEach(a=>{a.y+=a.v;a.o-=.003;const g=x.createRadialGradient(a.x,a.y,0,a.x,a.y,a.r*2.2);g.addColorStop(0,`rgba(255,255,255,${a.o})`);g.addColorStop(1,"transparent");x.fillStyle=g;x.beginPath();x.arc(a.x,a.y,a.r,0,Math.PI*2);x.fill()});
p=p.filter(a=>a.o>0);requestAnimationFrame(A)}
S(70);setInterval(()=>S(6),600);A();

/* QUESTIONS */
const qs=[
"–ì–¥–µ –≤—ã –≤–ø–µ—Ä–≤—ã–µ –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏—Å—å?",
"–ß—Ç–æ –≤—ã –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –≤—Å—Ç—Ä–µ—á–µ?",
"–ö—Ç–æ —Å–¥–µ–ª–∞–ª –ø–µ—Ä–≤—ã–π —à–∞–≥?",
"–ö–∞–∫–æ–π –º–æ–º–µ–Ω—Ç —Å—Ç–∞–ª —Ä–µ—à–∞—é—â–∏–º?",
"–ö–∞–∫ –≤—ã –ø–æ–Ω—è–ª–∏, —á—Ç–æ —ç—Ç–æ –ª—é–±–æ–≤—å?"
];
let i=0;
const label=document.getElementById("label"),
q=document.getElementById("q"),a=document.getElementById("a"),
bar=document.getElementById("bar"),perc=document.getElementById("perc"),
photoStep=document.getElementById("photoStep"),
questionStep=document.getElementById("questionStep");

function render(){label.textContent=`–í–æ–ø—Ä–æ—Å ${i+1} –∏–∑ 5`;q.textContent=qs[i];bar.style.width=(i/5)*100+'%';perc.textContent=Math.round((i/5)*100)+'%';a.value='';}
async function send(){
  const t=a.value.trim();
  if(t){
    await fetch("/api/sendMessage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:`üìñ *–û—Ç–≤–µ—Ç*\n\n‚ùì *${qs[i]}*\n‚úèÔ∏è ${t}`})});
  }
  i++;
  if(i<5)render();
  else{questionStep.style.display="none";photoStep.style.display="block";}
}
document.getElementById("next").onclick=send;
a.onkeydown=e=>{if(e.key==="Enter"){e.preventDefault();send();}};
render();

/* PHOTOS */
let selectedPhotos=[];
document.getElementById("photos").onchange=function(){
  selectedPhotos=[...this.files];renderPreviews();
};

function renderPreviews(){
  const box=document.getElementById("preview");box.innerHTML="";
  selectedPhotos.forEach((file,idx)=>{
    const div=document.createElement("div");
    div.className="preview-item";

    const img=document.createElement("img");
    img.src=URL.createObjectURL(file);
    img.className="preview-img";

    const rm=document.createElement("div");
    rm.className="remove-btn";
    rm.textContent="√ó";
    rm.onclick=()=>{
      div.classList.add("removing");
      setTimeout(()=>{
        selectedPhotos.splice(idx,1);
        renderPreviews();
      },200);
    };

    div.appendChild(img);
    div.appendChild(rm);
    box.appendChild(div);
  });
}

async function sendPhotos(){
  for(const p of selectedPhotos){
    const f=new FormData();f.append("photo",p);
    await fetch("/api/sendPhoto",{method:"POST",body:f});
  }
  alert("–§–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã ü§ç");
  finish();
}

/* MODAL */
function finish(){document.getElementById("payModal").style.display="flex";}
document.getElementById("payModal").onclick=e=>{
  if(e.target.id==="payModal")e.target.style.display="none";
};
</script>
</body>
</html>

