<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–ò—Å—Ç–æ—Ä–∏—è ‚Äî –í–æ–ø—Ä–æ—Å—ã</title>

<link href="https://fonts.googleapis.com/css2?family=Spectral+SC:wght@400;500;600&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">

<style>
:root{
  --cream:#FBF7F2; --ink:#4A3A39;
  --card:rgba(255,255,255,.78); --veil:rgba(255,255,255,.9);
  --gold2:#9b7f64; --gold3:#d7c29c; --gold4:#b99673;
  --shadow:0 14px 38px rgba(0,0,0,.14); --radius:26px;
}
*{margin:0;padding:0;box-sizing:border-box}
body{
  background:url("assets/background3.jpg") center/cover fixed no-repeat;
  color:var(--ink); font-family:"Playfair Display",serif; min-height:100vh;
}

/* Glitter */
#glitter{position:fixed; inset:0; pointer-events:none; z-index:1}

/* Card */
.container{max-width:780px;margin:120px auto;padding:20px}
.card{
  background:var(--card); backdrop-filter:blur(10px);
  border-radius:var(--radius); padding:32px;
  border:1px solid rgba(255,255,255,.92);
  box-shadow:var(--shadow); animation:fade .7s ease
}
@keyframes fade{from{opacity:0; transform:translateY(18px)} to{opacity:1; transform:none}}

h1{
  font-family:"Spectral SC",serif;text-align:center;margin-bottom:8px;
  background:linear-gradient(90deg,#9b7f64,#d7c29c,#b99673);
  -webkit-background-clip:text;color:transparent
}

/* Progress */
.progress-wrap{margin:10px 0 18px}
.progress-top{display:flex;justify-content:space-between;font-weight:600}
.progress{width:100%;height:8px;background:rgba(255,255,255,.6);border-radius:999px;overflow:hidden;margin-top:8px}
.bar{height:100%;width:0;background:linear-gradient(90deg,var(--gold2),var(--gold4));transition:.4s}

/* Question */
h2.q{font-family:"Spectral SC",serif;font-size:28px;margin:8px 0 12px}
textarea{
  width:100%;height:170px;padding:18px;border:none;border-radius:18px;
  background:var(--veil);font-size:20px;box-shadow:inset 0 2px 8px rgba(0,0,0,.06)
}

/* Buttons */
.btn{
  border:none;cursor:pointer;color:#fff;font-weight:700;
  background:linear-gradient(130deg,var(--gold2),var(--gold4));
  padding:14px 30px;border-radius:999px;font-size:20px;
  box-shadow:0 12px 32px rgba(0,0,0,.18);transition:.25s;margin-top:18px
}
.btn:hover{transform:translateY(-3px);opacity:.96}

/* After questions: photo step */
#photo-step{display:none;text-align:center}
.photo-input{margin-top:20px;font-size:18px;color:var(--ink)}
input[type=file]{
  padding:12px;border-radius:16px;background:var(--veil);
  width:100%;margin-top:10px;border:1px solid #e6d7c8;font-size:16px
}

/* Preview grid B (premium mini-cards) */
#preview{display:flex;flex-wrap:wrap;gap:10px;margin-top:15px;justify-content:center}
.preview-img{
  width:110px;height:110px;border-radius:16px;object-fit:cover;
  box-shadow:0 6px 18px rgba(0,0,0,.18);
  border:2px solid rgba(255,255,255,.8);
}

/* Modal tariffs */
.modal-back{
  position:fixed;inset:0;background:rgba(0,0,0,.45);
  backdrop-filter:blur(8px);display:none;align-items:center;
  justify-content:center;z-index:999
}
.modal{
  background:var(--card);border-radius:22px;padding:28px;
  max-width:420px;width:92%;box-shadow:var(--shadow);text-align:center;
}
.modal h3{
  font-family:"Spectral SC",serif;font-size:26px;margin-bottom:10px;
  background:linear-gradient(90deg,#9b7f64,#d7c29c,#b99673);
  -webkit-background-clip:text;color:transparent
}
.tariff{background:white;border-radius:18px;padding:18px;margin-top:14px;border:1px solid #e2d3c4}
.tariff p{margin-bottom:6px}

.photo-upload-btn{
  background:linear-gradient(130deg,#b99673,#d7c29c);
  color:white;
  padding:12px 26px;
  border-radius:999px;
  display:inline-block;
  cursor:pointer;
  font-weight:600;
  margin-bottom:12px;
}
.photo-upload-btn input{display:none}

.photo-preview{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-top:10px;
}
.photo-preview img{
  width:76px; height:76px;
  object-fit:cover;
  border-radius:14px;
  transition:.25s;
  box-shadow:0 4px 14px rgba(0,0,0,.12);
}
.photo-preview img:hover{
  transform:scale(1.06);
  box-shadow:0 8px 22px rgba(0,0,0,.16);
}

/* Modal */
.pay-modal{
  position:fixed; inset:0;
  display:none;
  justify-content:center; align-items:center;
  backdrop-filter:blur(14px);
  background:rgba(0,0,0,.25);
  z-index:80;
  animation:fadeIn .35s ease;
}
.modal-content{
  background:white;
  border-radius:22px;
  padding:30px;
  width:90%; max-width:420px;
  text-align:center;
  box-shadow:0 18px 45px rgba(0,0,0,.2);
  animation:pop .35s ease;
}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes pop{from{transform:scale(.92)}to{transform:scale(1)}}
.modal-title{font-family:"Spectral SC"; margin-bottom:20px}

.tariff{
  background:#faf6f0;
  border:1px solid rgba(0,0,0,.05);
  border-radius:16px;
  padding:18px;
  margin-bottom:16px;
}
.tariff .btn.small{
  width:100%;
  margin-top:8px;
  padding:10px;
  font-size:16px;
}

  .photo-preview-container{
  position:relative;
  display:inline-block;
}

.photo-remove{
  position:absolute;
  top:4px; right:4px;
  background:rgba(0,0,0,.6);
  color:white;
  width:20px; height:20px;
  border-radius:50%;
  font-size:14px;
  display:flex;
  justify-content:center; align-items:center;
  cursor:pointer;
  opacity:0;
  transition:.2s;
}

.photo-preview-container:hover .photo-remove{
  opacity:1;
}

.photo-preview-container img{
  width:76px; height:76px;
  object-fit:cover;
  border-radius:14px;
  transition:.25s;
  box-shadow:0 4px 14px rgba(0,0,0,.12);
}
.photo-preview-container img:hover{
  transform:scale(1.06);
  box-shadow:0 8px 22px rgba(0,0,0,.16);
}


  
</style>
</head>
<body>

<canvas id="glitter"></canvas>

<!-- Modal -->
<div id="payModal" class="modal-back">
  <div class="modal">
    <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ</h3>

    <div class="tariff">
      <p><b>‚ú® –°—Ç–∞–Ω–¥–∞—Ä—Ç ‚Äî 990‚ÇΩ</b></p>
      <p>PDF-–∫–Ω–∏–≥–∞ + —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏</p>
      <button class="btn" onclick="alert('–û–ø–ª–∞—Ç–∞ –ø–æ–¥–∫–ª—é—á–∏–º ‚ú®')">–í—ã–±—Ä–∞—Ç—å</button>
    </div>

    <div class="tariff">
      <p><b>üíé –ü—Ä–µ–º–∏—É–º ‚Äî 1990‚ÇΩ</b></p>
      <p>PDF + –ø–µ—á–∞—Ç—å + –¥–æ—Å—Ç–∞–≤–∫–∞</p>
      <button class="btn" onclick="alert('–û–ø–ª–∞—Ç–∞ —Å–∫–æ—Ä–æ üí≥')">–í—ã–±—Ä–∞—Ç—å</button>
    </div>
  </div>
</div>

<div class="container">
<div id="step-questions" class="card">
  <h1>–ü—Ä–æ–±–Ω–∞—è —á–∞—Å—Ç—å</h1>
  <div class="progress-wrap">
    <div class="progress-top"><span id="label">–í–æ–ø—Ä–æ—Å 1 –∏–∑ 5</span><span id="perc">0%</span></div>
    <div class="progress"><div id="bar" class="bar"></div></div>
  </div>
  <h2 id="q" class="q"></h2>
  <textarea id="a" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç..."></textarea>
  <button class="btn" id="next">–î–∞–ª–µ–µ</button>
</div>

<!-- PHOTO STEP -->
<div id="photo-step" class="card" style="display:none;">
  <h1>–î–æ–±–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ</h1>
  <p style="opacity:.9;">–ß—Ç–æ–±—ã –∫–Ω–∏–≥–∞ —Å—Ç–∞–ª–∞ –µ—â—ë —Ç–µ–ø–ª–µ–µ ü§ç<br><small>(–ü–æ –∂–µ–ª–∞–Ω–∏—é ‚Äî –º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å)</small></p>

  <label class="photo-upload-btn">
    üìé –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–æ—Ç–æ
    <input type="file" id="photos" multiple accept="image/*" class="photo-input">
  </label>

  <div id="preview" class="photo-preview"></div>
<p style="font-size:14px; opacity:.7; margin-top:6px;">–ù–∞–∂–º–∏—Ç–µ ‚ùå —á—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ</p>


  <button class="btn" onclick="sendPhotos()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</button>
  <button class="btn" style="margin-top:10px" onclick="finish()">–°–æ–∑–¥–∞—Ç—å –º–æ—é –∫–Ω–∏–≥—É ‚ù§Ô∏è</button>
</div>

<!-- MODAL tariffs -->
<div id="pay-modal" class="pay-modal">
  <div class="modal-content">
    <h2 class="modal-title">–í—ã–±–µ—Ä–∏ —Ñ–æ—Ä–º–∞—Ç –∫–Ω–∏–≥–∏</h2>

    <div class="tariff">
      <h3>üí´ Digital ‚Äî 9‚Ç¨</h3>
      <p>PDF-–∫–Ω–∏–≥–∞ + –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ + –¥–æ—Å—Ç–∞–≤–∫–∞ –≤ Telegram</p>
      <button class="btn small">–í—ã–±—Ä–∞—Ç—å</button>
    </div>

    <div class="tariff">
      <h3>üìñ –ü–µ—á–∞—Ç—å ‚Äî 39‚Ç¨</h3>
      <p>–ü–µ—á–∞—Ç—å –∫–Ω–∏–≥–∏ + PDF + –¥–æ—Å—Ç–∞–≤–∫–∞</p>
      <button class="btn small">–í—ã–±—Ä–∞—Ç—å</button>
    </div>
  </div>
</div>


<script>
/* Glitter */
const cvs=document.getElementById('glitter'),ctx=cvs.getContext('2d');let W,H,parts=[];
function resize(){W=cvs.width=innerWidth;H=cvs.height=innerHeight}addEventListener('resize',resize);resize();
function spawn(n=60){for(let i=0;i<n;i++)parts.push({x:Math.random()*W,y:Math.random()*-H*.2,r:Math.random()<.2?2.2+Math.random()*1.8:.8+Math.random()*1.2,v:1.2+Math.random()*1.2,g:Math.random()<.3})}
function step(){ctx.clearRect(0,0,W,H);ctx.globalCompositeOperation='lighter';for(const p of parts){p.y+=p.v;p.x+=Math.sin((p.y+p.r)*.01)*.3;const g=ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,p.r*2.2);g.addColorStop(0,'rgba(255,255,255,.8)');g.addColorStop(1,'rgba(255,255,255,0)');ctx.fillStyle=g;ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fill()}parts=parts.filter(p=>p.y<H+20);requestAnimationFrame(step)}
spawn(70);setInterval(()=>spawn(6),600);step();

/* Questions */
const qs=[
"–ì–¥–µ –≤—ã –≤–ø–µ—Ä–≤—ã–µ –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏—Å—å?",
"–ß—Ç–æ –≤—ã –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –≤—Å—Ç—Ä–µ—á–µ?",
"–ö—Ç–æ —Å–¥–µ–ª–∞–ª –ø–µ—Ä–≤—ã–π —à–∞–≥?",
"–ö–∞–∫–æ–π –º–æ–º–µ–Ω—Ç —Å—Ç–∞–ª —Ä–µ—à–∞—é—â–∏–º?",
"–ö–∞–∫ –≤—ã –ø–æ–Ω—è–ª–∏, —á—Ç–æ —ç—Ç–æ –ª—é–±–æ–≤—å?"
];

let i=0;
const label=document.getElementById("label"),q=document.getElementById("q"),
a=document.getElementById("a"),bar=document.getElementById("bar"),
perc=document.getElementById("perc");

function render(){label.textContent=`–í–æ–ø—Ä–æ—Å ${i+1} –∏–∑ 5`;q.textContent=qs[i];bar.style.width=(i/5)*100+'%';perc.textContent=Math.round((i/5)*100)+'%';a.value='';}
async function send(){
 const text=a.value.trim();
 if(text){
  await fetch("/api/sendMessage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:`üìñ *–û—Ç–≤–µ—Ç*\n\n‚ùì *${qs[i]}*\n‚úèÔ∏è ${text}`})});
 }
 i++;
 if(i<5){render()} else {
  document.getElementById("step-questions").style.display="none";
  document.getElementById("photo-step").style.display="block";
 }
}
document.getElementById("next").addEventListener("click",send);
a.addEventListener("keydown",e=>{if(e.key==="Enter"){e.preventDefault();send();}});
render();

/* Photo preview */
let selectedPhotos = [];

document.getElementById("photos").addEventListener("change", function(){
  selectedPhotos = [...this.files];
  renderPreviews();
});

function renderPreviews(){
  const preview = document.getElementById("preview");
  preview.innerHTML = "";

  selectedPhotos.forEach((file, index) => {
    const url = URL.createObjectURL(file);

    const div = document.createElement("div");
    div.className = "photo-preview-container";

    const img = document.createElement("img");
    img.src = url;

    const removeBtn = document.createElement("div");
    removeBtn.className = "photo-remove";
    removeBtn.textContent = "√ó";

    removeBtn.onclick = () => {
      selectedPhotos.splice(index, 1);
      renderPreviews();
    };

    div.appendChild(img);
    div.appendChild(removeBtn);
    preview.appendChild(div);
  });
}

// sendPhotos —Ç–µ–ø–µ—Ä—å —à–ª—ë—Ç selectedPhotos
async function sendPhotos(){
  if (!selectedPhotos.length) {
    alert("–§–æ—Ç–æ –Ω–µ –≤—ã–±—Ä–∞–Ω—ã, –Ω–æ —ç—Ç–æ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ üå∏");
    finish();
    return;
  }

  for (const photo of selectedPhotos){
    const fd = new FormData();
    fd.append("photo", photo);
    await fetch("/api/sendPhoto", { method:"POST", body:fd });
  }

  alert("–§–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã ü§ç");
  finish();
}


/* Send photos */
async function sendPhotos(){
 const files=document.getElementById("photos").files;
 for(let file of files){
  const fd=new FormData(); fd.append("file",file);
  await fetch("/api/sendPhoto",{method:"POST",body:fd});
  await new Promise(r=>setTimeout(r,300));
 }
 alert("–§–æ—Ç–æ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã üå∏");
}

/* Finish ‚Üí open tariffs modal */
function finish(){
 document.getElementById("payModal").style.display="flex";
}
  // –∑–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –æ–∫–Ω–∞
document.getElementById("payModal").addEventListener("click", (e)=>{
  if(e.target === e.currentTarget){
    document.getElementById("payModal").style.display="none";
  }
});

// –ø—Ä–µ–≤—å—é —Ñ–æ—Ç–æ
document.getElementById("photos").addEventListener("change", function(){
  const box=document.getElementById("preview");
  box.innerHTML="";
  [...this.files].forEach(f=>{
    const img=document.createElement("img");
    img.src=URL.createObjectURL(f);
    box.appendChild(img);
  });
});

// –ø–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª
function finish(){
  document.getElementById("pay-modal").style.display="flex";
}

// –∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –∫–ª–∏–∫–æ–º –ø–æ —Ñ–æ–Ω—É
document.addEventListener("click",e=>{
  const modal=document.getElementById("pay-modal");
  const content=document.querySelector(".modal-content");
  if(modal.style.display==="flex" && !content.contains(e.target)){
    modal.style.display="none";
  }
});

  
</script>
</body>
</html>
