<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ò—Å—Ç–æ—Ä–∏—è ‚Äî –í–æ–ø—Ä–æ—Å—ã</title>

<link href="https://fonts.googleapis.com/css2?family=Spectral+SC:wght@400;600&family=Playfair+Display:wght@400;500&display=swap" rel="stylesheet">

<style>
:root {
  --cream:#FBF7F2; --ink:#4A3A39;
  --card:rgba(255,255,255,.78); --veil:rgba(255,255,255,.9);
  --gold2:#9b7f64; --gold3:#d7c29c; --gold4:#b99673;
  --shadow:0 14px 38px rgba(0,0,0,.14); --radius:26px;
}

*{box-sizing:border-box;margin:0;padding:0}

body{
  background:url("assets/background3.jpg") center/cover fixed no-repeat;
  font-family:'Playfair Display',serif;
  color:var(--ink);
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:40px 10px;
}

/* Card */
.card{
  width:100%;
  max-width:760px;
  background:var(--card);
  backdrop-filter:blur(10px);
  border-radius:var(--radius);
  padding:34px;
  box-shadow:var(--shadow);
}

/* Title */
h1 {
  font-family:"Spectral SC",serif;
  font-size:32px;
  text-align:center;
  margin-bottom:20px;
  background:linear-gradient(90deg,#6a5447,#9b7f64,#d7c29c,#b99673,#7a5f4e);
  -webkit-background-clip:text;
  color:transparent;
}

/* Question */
h2 {font-size:26px;margin-bottom:14px;}
textarea{
  width:100%;height:180px;
  padding:18px;border:none;border-radius:18px;
  background:var(--veil);
  font-size:20px;
  box-shadow:inset 0 2px 8px rgba(0,0,0,.06);
}

/* Buttons */
.btn{
  border:none;cursor:pointer;color:#fff;font-weight:700;
  background:linear-gradient(130deg,var(--gold2),var(--gold4));
  padding:14px 30px;border-radius:999px;font-size:18px;
  box-shadow:0 12px 32px rgba(0,0,0,.18);
  transition:.25s;margin-top:18px;
}
.btn:hover{transform:translateY(-3px);opacity:.96}
.btn-full{width:100%}

/* Photo area */
#photo-step{display:none;text-align:center}
.photo-upload-btn{
  cursor:pointer;padding:14px 32px;
  background:linear-gradient(130deg,var(--gold2),var(--gold4));
  color:white;border-radius:999px;font-weight:600;
  font-size:18px;margin:14px auto;display:inline-block;
  box-shadow:0 12px 32px rgba(0,0,0,.18)
}
#photos{display:none}

#preview{
  margin-top:14px;display:flex;flex-wrap:wrap;
  gap:12px;justify-content:center;
}

.preview-item{
  position:relative; width:90px; height:90px;
  border-radius:12px; overflow:hidden; cursor:pointer;
  box-shadow:0 6px 16px rgba(0,0,0,.16);
  transition:.25s;
}
.preview-item:hover{transform:scale(1.05)}

.preview-item img{
  width:100%;height:100%;object-fit:cover;
}

.delete-x{
  position:absolute;top:6px;right:6px;
  background:rgba(0,0,0,.6);
  color:white;border-radius:50%;
  width:22px;height:22px;
  font-size:14px;display:flex;
  justify-content:center;align-items:center;
  cursor:pointer;
}

/* Modal */
.modal-bg{
  position:fixed;inset:0;
  background:rgba(0,0,0,.55);
  display:none;justify-content:center;align-items:center;
}
.modal{
  background:white;padding:32px;border-radius:18px;
  max-width:420px;width:92%;text-align:center;
  font-size:20px;
}

.tariff-modal{
  width:100%;
  max-width:420px;
}

.tariff-card{
  background:#fefefe;
  border:1px solid rgba(180,160,130,.35);
  border-radius:14px;
  padding:18px;
  margin:12px 0;
  box-shadow:0 8px 20px rgba(0,0,0,.08);
  text-align:center;
}

.tariff-card h3{
  font-family:"Spectral SC",serif;
  margin-bottom:6px;
}

.tariff-card strong{
  display:block;
  font-size:22px;
  margin:8px 0;
  color:#8e6c50;
}

</style>
</head>
<body>

<div class="card" id="main-step">
  <h1>–ü—Ä–æ–±–Ω–∞—è —á–∞—Å—Ç—å</h1>

  <h2 id="question">–ì–¥–µ –≤—ã –≤–ø–µ—Ä–≤—ã–µ –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏—Å—å?</h2>
  <textarea id="answer" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç..."></textarea>

  <button class="btn btn-full" id="nextBtn">–î–∞–ª–µ–µ</button>
</div>

<!-- PHOTO STEP -->
<div class="card" id="photo-step">
  <h1>–î–æ–±–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ</h1>
  <p>–ß—Ç–æ–±—ã –∫–Ω–∏–≥–∞ —Å—Ç–∞–ª–∞ –µ—â—ë —Ç–µ–ø–ª–µ–µ üíó <br>(–ø–æ –∂–µ–ª–∞–Ω–∏—é ‚Äî –º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å)</p>

  <label class="photo-upload-btn">
    üìé –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–æ—Ç–æ
    <input type="file" id="photos" multiple accept="image/*">
  </label>

  <div id="preview"></div>

  <button class="btn" onclick="sendPhotos()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</button>
  <button class="btn" onclick="finish()">–°–æ–∑–¥–∞—Ç—å –º–æ—é –∫–Ω–∏–≥—É üíñ</button>
</div>

<!-- PAY MODAL -->
<div id="payModal" class="modal-bg">
  <div class="modal tariff-modal">
    <h2 style="margin-bottom: 14px;">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ üíù</h2>

    <div class="tariff-card">
      <h3>‚ú® –ë–∞–∑–æ–≤—ã–π</h3>
      <p>100 –≤–æ–ø—Ä–æ—Å–æ–≤ + PDF –∫–Ω–∏–≥–∞</p>
      <strong>29‚Ç¨</strong>
      <button class="btn btn-full" onclick="pay('basic')">–ö—É–ø–∏—Ç—å</button>
    </div>

    <div class="tariff-card">
      <h3>üíé –ü—Ä–µ–º–∏—É–º</h3>
      <p>PDF –∫–Ω–∏–≥–∞ + –ú–∞–∫–µ—Ç –¥–ª—è –ø–µ—á–∞—Ç–∏ + –î–∏–∑–∞–π–Ω-–æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</p>
      <strong>59‚Ç¨</strong>
      <button class="btn btn-full" onclick="pay('premium')">–ö—É–ø–∏—Ç—å</button>
    </div>

    <p style="opacity:.7;font-size:14px;margin-top:12px;">
      –ù–∞–∂–º–∏—Ç–µ –≤–Ω–µ –æ–∫–Ω–∞, —á—Ç–æ–±—ã –∑–∞–∫—Ä—ã—Ç—å
    </p>
  </div>
</div>

<script>
/* QUESTIONS LOGIC */
const questions = [
  "–ì–¥–µ –≤—ã –≤–ø–µ—Ä–≤—ã–µ –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏—Å—å?",
  "–ß—Ç–æ –≤—ã –ø–æ–¥—É–º–∞–ª–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –≤—Å—Ç—Ä–µ—á–µ?",
  "–ö—Ç–æ —Å–¥–µ–ª–∞–ª –ø–µ—Ä–≤—ã–π —à–∞–≥?",
  "–ö–∞–∫–æ–π –º–æ–º–µ–Ω—Ç —Å—Ç–∞–ª —Ä–µ—à–∞—é—â–∏–º –¥–ª—è –≤–∞—Å?",
  "–ß—Ç–æ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –∑–∞–ø–æ–º–Ω–∏–ª–æ—Å—å –≤ —Ç–æ—Ç –¥–µ–Ω—å?"
];

let index = 0;
const q = document.getElementById("question");
const a = document.getElementById("answer");
const next = document.getElementById("nextBtn");

async function sendAnswer(q, a){
  if(!a.trim()) return;
  await fetch("/api/sendMessage",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({text:`‚ùì${q}\n‚úèÔ∏è ${a}`})
  });
}

function showPhotosStep(){
  document.getElementById("main-step").style.display="none";
  document.getElementById("photo-step").style.display="block";
}

next.onclick = async ()=>{
  if(a.value.trim()) await sendAnswer(questions[index], a.value);
  index++;
  if(index<questions.length){
    q.textContent = questions[index];
    a.value='';
  } else showPhotosStep();
};

a.addEventListener("keydown", e => {
  if(e.key === "Enter" && !e.shiftKey){
    e.preventDefault();
    next.click();
  }
});

/* PHOTO PREVIEW + DELETE */
let files = [];

document.getElementById("photos").onchange = (e)=>{
  for(let f of e.target.files) files.push(f);
  renderPhotos();
};

function renderPhotos(){
  const box = document.getElementById("preview");
  box.innerHTML = "";
  files.forEach((file,i)=>{
    const url = URL.createObjectURL(file);
    box.innerHTML += `
      <div class="preview-item">
        <span class="delete-x" onclick="removePhoto(${i})">‚úñ</span>
        <img src="${url}">
      </div>`;
  });
}

function removePhoto(i){
  files.splice(i,1);
  renderPhotos();
}

/* SEND PHOTOS */
async function sendPhotos(){
  if(files.length===0){ showPay(); return; }

  for(let f of files){
    const fd = new FormData();
    fd.append("photo", f);
    await fetch("/api/sendPhoto",{method:"POST",body:fd});
  }
  showPay();
}

/* SHOW MODAL */
function showPay(){
  document.getElementById("payModal").style.display="flex";
}

document.getElementById("payModal").onclick = e=>{
  if(e.target.id==="payModal") e.target.style.display="none";
}

function finish(){ showPay(); }
function pay(type){
  console.log("–û–ø–ª–∞—Ç–∞ —Ç–∞—Ä–∏—Ñ–∞:", type);
  alert("–¢—É—Ç –±—É–¥–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –æ–ø–ª–∞—Ç–∞ ‚Äî —Å–∫–æ—Ä–æ üöÄ");
}
</script>
</body>
</html>